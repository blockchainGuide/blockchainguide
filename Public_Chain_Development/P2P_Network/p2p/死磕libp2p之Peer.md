## Peer ID 

对等体标识（通常写为PeerID）是对整个对等网络中特定对等体的**唯一引用**。

除了作为每个对等体的唯一标识符外，**对等体ID也是对等体与其公共密钥之间的可验证链接**。

每个libp2p对等端都控制一个私钥，对所有其他对等端保密。每个私钥都有一个相应的公钥，并与其他对等方共享。

公钥和私钥（或“密钥对”）一起允许对等方建立彼此之间的安全通信信道。

从概念上讲，**对等体ID是对等体公钥的加密哈希**。当对等方建立安全通道时，散列可以用于验证用于保护通道的公钥是否与用于识别对等方的公钥相同。

[Peer ID规范](https://github.com/libp2p/specs/blob/master/peer-ids/peer-ids.md)详细介绍了用于libp2p公钥的字节格式，以及如何对密钥进行散列以生成有效的Peer ID。



## 对等 ID 如何表示为字符串

对等Id是多散列，它被定义为一种紧凑的二进制格式。

使用比特币使用的相同字母表，将多哈希编码到base58是很常见的。

以下是对等ID的一个示例，表示为base58编码的多散列：QmYyQSo1c1Ym7或WxLYvCrM2EmxFTANf8wXmmE7DWjhx5N

虽然可以用许多文本格式（例如，十六进制、base64等）表示多散列，但对等ID总是使用base58编码，在编码为字符串时没有多基前缀

## 多地址中的Peer ID

对等体ID可以作为p2p地址编码到多地址中，并将对等体ID作为参数。

如果我的对等ID是QmYyQSo1c1Ym7或WxLYvCrM2EmxFTANf8wXmmE7DWjhx5N，则我的libp2p多地址为

```markdown
/p2p/QmYyQSo1c1Ym7orWxLYvCrM2EmxFTANf8wXmmE7DWjhx5N
```

与其他多地址一样，可以将P2P地址封装到另一个多地址中，以组成一个新的多地址。例如，我可以将上面的内容与**传输地址/ip4/198.51.100.0/tcp/4242**结合起来，生成这个非常有用的地址：

```markdown
/ip4/198.51.100.0/tcp/4242/p2p/QmYyQSo1c1Ym7orWxLYvCrM2EmxFTANf8wXmmE7DWjhx5N
```

这提供了足够的信息，可以通过TCP/IP传输拨打特定的对等方。在拨号过程中，如果遇到了IP地址或端口被其他节点使用的情况，由于Peer ID是由密钥生成的，因此控制该IP地址或端口的节点将无法使用相同的Peer ID，这一点很容易被察觉。因此，通过Peer ID来标识节点，能够帮助我们避免遇到恶意节点的欺诈行为。

## Peer Info

另一种与对等身份相关的常见libp2p数据结构是PeerInfo结构。

对等方信息将对**等方ID与对等方正在侦听的一组多地址**相结合。

## Peer store

ibp2p节点通常会有一个临时存储区来**存储对等密钥、地址和相关元数据**。peer store 的工作原理类似于电话簿或通讯簿；把它想象成一本通用的多地址书，为所有已知的同行维护真实来源。

具体而言，Peerstore用于存储以下信息：

- 节点ID
- 节点地址列表
- 节点公钥等

Peerstore在P2P网络中扮演着非常重要的角色，因为它允许节点了解其他节点的信息并建立与这些节点的连接。例如，当节点需要与另一个节点进行连接时，它可以在Peerstore中查找该节点的信息，包括其ID和地址等，然后利用这些信息向该节点发起连接请求。

Peerstore还允许节点根据需要管理其他节点的信息，例如删除过期或不再需要的节点信息，或向Peerstore中添加新的节点信息等。这在处理网络故障和节点失效等情况时非常有用。

## Peer Discovery

当peer store中没有关于某个节点的信息时，需要使用发现方法来寻找其地址信息。一般情况下，可以通过节点的Peer ID来发现其地址。当一个节点的地址被成功发现并与其建立连接后，其信息（包括Peer ID和地址）将被添加到peer store中，以备后续使用。

如果peer store中没有关于某个节点的信息，则需使用发现方法来寻找其地址信息。peer routing guide中提供了有关如何发现未知节点的更多信息。添加新节点信息的过程中，会将该节点的连接地址和节点信息存储在peer store中供其他节点查找和使用。通过这种方式，可以使网络中的节点互相发现和连接，从而增强P2P网络的稳定性和可用性。[广泛的连接协议](https://connectivity.libp2p.io/)。